
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UPI PhonePe Style</title>

<!-- QR Scanner -->
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
:root{
  --pp:#5f259f;
  --bg:#0e0e1a;
  --card:#24243e;
  --muted:#9ca3af;
}

*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;background:var(--bg);color:white;
  display:flex;justify-content:center;
}
.app{
  max-width:420px;width:100%;min-height:100vh;
  padding-bottom:70px;
}

/* HEADER */
.header{
  background:var(--pp);
  padding:18px;
  font-size:20px;
  font-weight:600;
  border-radius:0 0 22px 22px;
}

/* CARD */
.card{
  background:var(--card);
  margin:14px;
  padding:16px;
  border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.5);
}
.card h3{margin-top:0}

/* INPUTS */
input,select,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border:none;
  border-radius:12px;
  font-size:14px;
}
input,select{background:#1c1c28;color:white}
button{
  background:var(--pp);
  color:white;
  font-weight:600;
  cursor:pointer;
}

/* BANK TAG */
.bank{
  background:#1c1c28;
  padding:8px;
  border-radius:10px;
  margin-top:6px;
  font-size:13px;
}

/* TX TABLE */
table{width:100%;font-size:12px;border-collapse:collapse}
td{padding:6px;border-bottom:1px solid #374151}

/* NAV */
.nav{
  position:fixed;
  bottom:0;
  width:100%;
  max-width:420px;
  background:#1c1c28;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}
.nav button{
  background:none;
  color:#9ca3af;
}
.nav button.active{
  color:#a78bfa;
}
</style>
</head>

<body>
<div class="app">
  <div class="header">ðŸ“± Nano Pay</div>

  <!-- CREATE -->
  <div class="card screen" id="home">
    <h3>Create UPI</h3>
    <input id="name" placeholder="Name">
    <input id="upi" placeholder="UPI ID (alice@upi)">
    <input id="bank" placeholder="Bank Name">
    <input id="bal" type="number" placeholder="Initial Balance">
    <input id="pin" type="password" placeholder="UPI PIN">
    <button onclick="createUPI()">Create</button>
  </div>

  <!-- PAY -->
  <div class="card screen" id="pay" style="display:none">
    <h3>Pay</h3>
    <input id="from" placeholder="Your UPI">
    <select id="bankSel"></select>
    <input id="to" placeholder="Payee UPI">
    <input id="amt" type="number" placeholder="Amount">
    <input id="pin2" type="password" placeholder="PIN">
    <button onclick="pay()">Pay Now</button>
  </div>

  <!-- SCAN -->
  <div class="card screen" id="scan" style="display:none">
    <h3>Scan & Pay</h3>
    <div id="reader"></div>
    <input id="scanAmt" type="number" placeholder="Amount">
    <input id="scanPin" type="password" placeholder="PIN">
    <button onclick="startScan()">Start Camera</button>
  </div>

  <!-- TX -->
  <div class="card screen" id="tx" style="display:none">
    <h3>Transactions</h3>
    <table><tbody id="txs"></tbody></table>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <button onclick="show('home')" class="active">Home</button>
  <button onclick="show('pay')">Pay</button>
  <button onclick="show('scan')">Scan</button>
  <button onclick="show('tx')">History</button>
</div>

<script>
/* ===== SINGLETON UPI SERVER ===== */
class UPIServer{
  constructor(){
    if(UPIServer.i) throw "Singleton";
    this.users = JSON.parse(localStorage.getItem("users")) || {};
    this.txs   = JSON.parse(localStorage.getItem("txs")) || [];
    UPIServer.i = this;
  }
  static get(){ return this.i || new UPIServer(); }

  save(){
    localStorage.setItem("users",JSON.stringify(this.users));
    localStorage.setItem("txs",JSON.stringify(this.txs));
  }

  create(name,upi,bank,bal,pin){
    if(this.users[upi]) throw "UPI exists";
    this.users[upi]={
      name,pin,
      banks:[{bank,balance:+bal}]
    };
    this.txs.unshift({d:`UPI ${upi} created`,a:bal});
    this.save();
  }

  pay(from,bankIndex,to,amt,pin){
    if(!this.users[from]||!this.users[to]) throw "Invalid UPI";
    if(this.users[from].pin!==pin) throw "Wrong PIN";
    const fb=this.users[from].banks[bankIndex];
    const tb=this.users[to].banks[0];
    if(fb.balance<amt) throw "Insufficient balance";
    fb.balance-=amt;
    tb.balance+=amt;
    this.txs.unshift({d:`${from} â†’ ${to}`,a:amt});
    this.save();
  }
}

const server = UPIServer.get();

/* ===== UI LOGIC ===== */
function createUPI(){
  try{
    server.create(name.value,upi.value,bank.value,bal.value,pin.value);
    alert("UPI Created");
  }catch(e){alert(e);}
}

from.onchange = ()=>{
  bankSel.innerHTML="";
  const u = server.users[from.value];
  if(!u) return;
  u.banks.forEach((b,i)=>{
    bankSel.innerHTML+=
      `<option value="${i}">
        ${b.bank} â€¢ â‚¹${b.balance}
      </option>`;
  });
};

function pay(){
  try{
    server.pay(
      from.value,
      bankSel.value,
      to.value,
      +amt.value,
      pin2.value
    );
    alert("Payment Successful");
    render();
  }catch(e){alert(e);}
}

/* ===== REAL QR SCAN ===== */
let qr;
function startScan(){
  qr = new Html5Qrcode("reader");
  qr.start(
    { facingMode:"environment" },
    { fps:10, qrbox:250 },
    text=>{
      const d=JSON.parse(text);
      server.pay(
        d.from,
        d.bank,
        d.upi,
        +scanAmt.value,
        scanPin.value
      );
      alert("QR Payment Success");
      qr.stop();
      render();
    }
  );
}

/* ===== RENDER ===== */
function render(){
  txs.innerHTML="";
  server.txs.forEach(x=>{
    txs.innerHTML+=
      `<tr><td>${x.d}</td><td>â‚¹${x.a}</td></tr>`;
  });
}

/* ===== NAV ===== */
function show(id){
  document.querySelectorAll(".screen").forEach(x=>x.style.display="none");
  document.getElementById(id).style.display="block";
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
  render();
}
</script>
</body>
</html>


